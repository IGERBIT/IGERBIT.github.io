<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>19/20/21</title>
</head>
<body>
	<input name="target" id="target" type="number" value="77">
	<input name="stack" id="stack" type="text" value="7">
	<textarea name="fncs" id="fncs" cols="30" rows="10"
	>(a,i) => a[i]++
(a,i) => a[i] *= 2</textarea>
	<input name="min" id="min" type="checkbox">
	<input  type="submit" onclick="calc()">
	<div id="result" ></div>
	<script>
		
		const txt = document.getElementById('result');
		const f= (mx,e,z,min=0,n=(a,fs,c)=>a.reduce((ac,_,i)=>[...ac,...fs.map(f=>(c=[...a],f(c,i),c))],[]),p=s=>s.reduce((a,b)=>a+b,0),ch=s=>Array.isArray(s[0])?s.some(ch):(min?p(s)<=mx:p(s)>=mx),j=[...Array(101).keys()])=>[(f=>j.filter(i=>(f=n([...e,i],z),i&&!ch(f)&&ch(f.map(v=>n(v,z))))))(),((f,s)=>j.filter(i=>(f=n([...e,i],z),i &&!ch(f)&&f.some(fs=>(s=n(fs,z),!ch(s)&&s.every(v=>ch(n(v,z))))))))(),((g,f,s,t)=>j.filter(i=>(g=0,f=n([...e,i],z),i&&!ch(f)&&f.every(ff=>(s=n(ff,z),ch(s)?!0:g=s.some(sf=>(t=n(sf,z),!ch(t)&&t.every(v=>ch(n(v,z)))))))&&g)))()];
		
		let parseF = text => text.startsWith('+') ? (a,i) => a[i] += +text.slice(1) : text.startsWith('*') ? (a,i) => a[i] *= +text.slice(1) : eval(text)


		function calc(){
			let target = document.getElementById('target').value;
			let stack = document.getElementById('stack').value;
			let fncs = document.getElementById('fncs').value;
			let min = document.getElementById('min').checked;

			if(target && fncs){
				try {
					let r = f(+target,!stack ? [] : stack.split(',').map(x => +x), fncs.split('\n').map(parseF),min);
					txt.innerText = `19: ${r[0].join(', ')}\n20: ${r[1].join(', ')}\n21: ${r[2].join(', ')}`
				}
				catch(e){
					txt.textContent = `ERROR: ${e}`
				}
			}
		}
		
		

	</script>
</body>
</html>